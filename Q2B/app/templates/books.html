{% extends "base.html" %}

{% block mainblock %}

<div class="container-fluid px-3">

  <!-- Filter Bar - FORM-BASED -->
  <div class="mb-4 p-3" style="background-color: #e8f5e9; border-radius: 5px;">
    
    <!-- DESKTOP: All on one line -->
    <form method="GET" action="/BookTitles" class="d-none d-md-flex align-items-center justify-content-between">
      <div>
        <strong class="text-dark">Number of titles: {{ all_books|length }}</strong>
      </div>
      <div class="d-flex align-items-center">
        <label class="mr-2 font-weight-bold mb-0 text-dark">Category</label>
        <select name="category" class="form-control form-control-sm mr-2" style="width: 150px;">
          <option value="All" {% if selected_category == 'All' %}selected{% endif %}>All</option>
          <option value="Children" {% if selected_category == 'Children' %}selected{% endif %}>Children</option>
          <option value="Teens" {% if selected_category == 'Teens' %}selected{% endif %}>Teens</option>
          <option value="Adult" {% if selected_category == 'Adult' %}selected{% endif %}>Adult</option>
        </select>
        <button type="submit" class="btn btn-success btn-sm px-4">Search</button>
      </div>
    </form>

    <!-- MOBILE: Stacked layout -->
    <form method="GET" action="/BookTitles" class="d-md-none">
      <div class="mb-2">
        <strong class="text-dark">Number of titles: {{ all_books|length }}</strong>
      </div>
      <div class="mb-2">
        <label class="font-weight-bold text-dark d-block mb-1">Category</label>
        <select name="category" class="form-control form-control-sm">
          <option value="All" {% if selected_category == 'All' %}selected{% endif %}>All</option>
          <option value="Children" {% if selected_category == 'Children' %}selected{% endif %}>Children</option>
          <option value="Teens" {% if selected_category == 'Teens' %}selected{% endif %}>Teens</option>
          <option value="Adult" {% if selected_category == 'Adult' %}selected{% endif %}>Adult</option>
        </select>
      </div>
      <div class="d-flex justify-content-end">
        <button type="submit" class="btn btn-success btn-sm px-4">Search</button>
      </div>
    </form>
  </div>

  <!-- Book List Cards -->
  {% for book in all_books %}
  <div class="card mb-4 shadow-sm">
    <div class="row no-gutters">
      
      <!-- Book Image Column -->
      <div class="col-12 col-sm-3 col-md-2 d-flex justify-content-center align-items-center p-3" style="background-color: #f8f9fa;">
        <img src="{{ book.url }}" class="img-fluid rounded book-cover-list" 
             alt="{{ book.title }}">
      </div>

      <!-- Book Info Column -->
      <div class="col-12 col-sm-9 col-md-10">
        <div class="card-body">
          <h5 class="card-title font-weight-bold mb-2">{{ book.title }}</h5>
          <p class="text-muted mb-2">By {{ book.authors|join(', ') }}</p>
          
          <p class="card-text mb-1">
            <strong>Category:</strong> {{ book.category }}, {{ book.genres|join(', ') }}
          </p>
          
          <p class="card-text mb-3">
            <strong>Pages:</strong> {{ book.pages }}
          </p>
          
          <p class="card-text mb-3">{{ book.short_description }}</p>
          
          <!-- Buttons - Make a Loan OR More Details -->
          <div class="d-flex justify-content-end">
            {% if book.available > 0 %}
              {% if current_user.is_authenticated %}
                <a href="{{ url_for('loanController.make_loan', book_title=book.title) }}"
                  class="btn btn-success mr-2">
                  Make a Loan
                </a>
              {% else %}
                <a href="{{ url_for('auth.login') }}"
                  class="btn btn-success mr-2">
                  Make a Loan
                </a>
              {% endif %}
            {% endif %}
              <a href="{{ url_for('packageController.viewBookDetail', book_title=book.title) }}"
                 class="btn btn-success">
              More details
            </a>
          </div>
        </div>
      </div>

    </div>
  </div>
  {% endfor %}

</div>

{% endblock %}